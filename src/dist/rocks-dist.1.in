.\" $Id: rocks-dist.1.in,v 1.8 2008/03/06 23:41:41 mjk Exp $
.\"
.\" @Copyright@
.\" 
.\" 				Rocks(r)
.\" 		         www.rocksclusters.org
.\" 		            version 5.0 (V)
.\" 
.\" Copyright (c) 2000 - 2008 The Regents of the University of California.
.\" All rights reserved.	
.\" 
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions are
.\" met:
.\" 
.\" 1. Redistributions of source code must retain the above copyright
.\" notice, this list of conditions and the following disclaimer.
.\" 
.\" 2. Redistributions in binary form must reproduce the above copyright
.\" notice unmodified and in its entirety, this list of conditions and the
.\" following disclaimer in the documentation and/or other materials provided 
.\" with the distribution.
.\" 
.\" 3. All advertising and press materials, printed or electronic, mentioning
.\" features or use of this software must display the following acknowledgement: 
.\" 
.\" 	"This product includes software developed by the Rocks(r)
.\" 	Cluster Group at the San Diego Supercomputer Center at the
.\" 	University of California, San Diego and its contributors."
.\" 
.\" 4. Except as permitted for the purposes of acknowledgment in paragraph 3,
.\" neither the name or logo of this software nor the names of its
.\" authors may be used to endorse or promote products derived from this
.\" software without specific prior written permission.  The name of the
.\" software includes the following terms, and any derivatives thereof:
.\" "Rocks", "Rocks Clusters", and "Avalanche Installer".  For licensing of 
.\" the associated name, interested parties should contact Technology 
.\" Transfer & Intellectual Property Services, University of California, 
.\" San Diego, 9500 Gilman Drive, Mail Code 0910, La Jolla, CA 92093-0910, 
.\" Ph: (858) 534-5815, FAX: (858) 534-7345, E-MAIL:invent@ucsd.edu
.\" 
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS''
.\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
.\" THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
.\" PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS
.\" BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
.\" CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
.\" SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
.\" BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
.\" WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
.\" OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
.\" IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\" 
.\" @Copyright@
.\"
.\" $Log: rocks-dist.1.in,v $
.\" Revision 1.8  2008/03/06 23:41:41  mjk
.\" copyright storm on
.\"
.\" Revision 1.7  2007/06/23 04:03:21  mjk
.\" mars hill copyright
.\"
.\" Revision 1.6  2006/09/11 22:47:08  mjk
.\" monkey face copyright
.\"
.\" Revision 1.5  2006/08/10 00:09:31  mjk
.\" 4.2 copyright
.\"
.\" Revision 1.4  2005/10/12 18:08:37  mjk
.\" final copyright for 4.1
.\"
.\" Revision 1.3  2005/09/16 01:02:17  mjk
.\" updated copyright
.\"
.\" Revision 1.2  2005/05/24 21:21:53  mjk
.\" update copyright, release is not any closer
.\"
.\" Revision 1.1  2005/03/01 02:02:47  mjk
.\" moved from core to base
.\"
.\" Revision 1.17  2004/03/25 03:15:36  bruno
.\" touch 'em all!
.\"
.\" update version numbers to 3.2.0 and update copyrights
.\"
.\" Revision 1.16  2003/08/15 22:34:46  mjk
.\" 3.0.0 copyright
.\"
.\" Revision 1.15  2003/05/22 16:39:27  mjk
.\" copyright
.\"
.\" Revision 1.14  2003/02/17 18:43:04  bruno
.\" updated copyright to 2003
.\"
.\" Revision 1.13  2002/10/18 21:33:26  mjk
.\" Rocks 2.3 Copyright
.\"
.\" Revision 1.12  2002/02/21 21:33:28  bruno
.\" added new copyright
.\"
.\" Revision 1.11  2001/06/12 18:13:50  mjk
.\" - Added Force RPMS directory to docs
.\" - Always create a Force RPMS directory
.\"
.\" Revision 1.10  2001/05/09 20:17:21  bruno
.\" bumped copyright 2.1
.\"
.\" Revision 1.9  2001/05/08 21:08:23  mjk
.\" --sdsc was coded backwards (don't know when this happened)
.\"
.\" Revision 1.8  2001/05/07 22:29:13  mjk
.\" - Release candidate 1
.\"
.\" Revision 1.7  2001/04/27 01:08:50  mjk
.\" - Created working 7.0 and 7.1 distibutions (in same tree even)
.\" - Added symlink() method to File object.  Trying to get the File object
.\"   to make the decision on absolute vs. relative symlinks.  So far we are
.\"   absolute everywhere.
.\" - Still missing CD making code.  Need to figure out how to read to
.\"   comps files using RedHat's anaconda python code.  Then we can decide
.\"   which RPMs can go on the second CD based on what is required in the
.\"   kickstart files.
.\"
.\" Revision 1.6  2001/04/10 14:16:28  bruno
.\" updated copyright
.\"
.\" Revision 1.5  2001/02/21 01:01:36  mjk
.\" More web docs
.\"
.\" Revision 1.4  2001/02/14 20:16:31  mjk
.\" Release 2.0 Copyright
.\"
.\" Revision 1.3  2000/11/03 06:11:22  mjk
.\" *** empty log message ***
.\"
.TH rocks-dist "1" "@DATE@" "@PACKAGE@" "@VENDOR@"

.SH NAME
rocks-dist \- builds a NPACI Rocks Linux distribution

.SH SYNOPSIS

.B rocks-dist
[\fIOPTION\fR]... [\fICOMMAND\fR]...

.SH DESCRIPTION

Controls all aspects of building RedHat based NPACI Rocks Clusters
software distributions.  This includes building a mirror to the
official Rocks Cluster FTP site, adding your own site specific RPMS,
and allowing other sites to mirror off of your site.

Rocks-dist computes RPM version numbers for each package built into a
distribution and only the most recent versions are used.  The official
NPACI Rocks Cluster distribution is built this way and is the default
mirror for building your own distribution.  By basing your
distribution on NPACI Rocks you insure that you always have the most
recent software possible.

.SH COMMANDS

.TP
\fBclean\fR


Removes all the generated files from a distribtuion.  This is always
performed as part of the \fIdist\fR command.

.TP
\fBcdrom\fR


Create a new distribution suitable for burning onto a CD.  This
distribution contains only the RPMs used by the Rocks kickstart files,
and is not a general purpose distribtuion. 

.TP
\fBdist\fR 


Creates a new distribution with RPMS gathered from a local NPACI Rocks
or RedHat mirror.  RPMS are also added from the host's local RPM
directory \fI/usr/src/redhat/RPMS\fR and third party RPMS in the
directory \fI<root>/contrib/public\fR, where <root> is specified by the
\fB\-\-root\fR flag.

.TP
\fBgehdlist\fR


Rebuilds the RedHat RPM database once a distribution has been
created.  By default whenever the \fBdist\fR command is used then
\fBgenhdlist\fR command is automatically applied.  If you manually
replace an RPM in the distribution you will need to use the command to
update the package database.

.TP
\fBmirror\fR


Builds a RedHat or NPACI Rocks mirror.  Using the default setting for
rocks-dist this command will build a local mirror of the official
NPACI Rocks distribution.  The mirror you build will be the main
source of RPMS for the \fBdist\fR command.

.TP
\fBpaths\fR


Prints a list of pathnames controlled by the Distribution objects in
the rocks-dist Python code.  This is used by developers.

.SH OPTIONS

.TP
\fB\-a\fR,\fB\-\-arch\fR=\fIARCH\fR


Sets the cpu architecture, where ARCH is a cpu string used by RedHat
in their distribution naming scheme.  The default value is \fIi386\fR.

.TP
\fB\-c\fR,\fB\-\-copy\fR    


When a distribution is created with the \fBdist\fR command the
distribution consists only of symbolic link to the actual RPMS.  If
you need to kickstart over NFS (the only mode supported in RedHat 6.2)
than the symbolic links must be expanded to the actual files.  As of
RedHat 7.0 (and Rocks 2.0) Kickstarts can be performed almost entirely
over HTTP.

This flag replaces the \fBexplode\fR command from cluster-dist.


.TP
\fB\-\-cvs\-host\fR=\fIHOSTNAME\fR,\fB\-\-cvs\-path\fR=\fIPATH\fR


Set the location of the CVS repository used to checkout the
\fBbuild\fR directory containing kickstart files.  If the
\fB-\-cvs\-path\fR flag is not provided no CVS repository is accessed.
If the \fB\-\-cvs\-host\fR flag is not provided the CVS repository is
assumed to be on the local host.  Currently only the top level Rock
distribution used this.  In the future, derived distribution will
access kickstart files from CVS.

.TP
\fB-d\fR,\fB\-\-dist\fR=\fINAME\fR 

Sets the NAME of the directory for the newly created distribution.
The default value is \fIrocks-dist\fR.  By choosing a unique NAME
one can support multiple simultaneous cluster distributions.  This is
useful for testing, and if you need specific packages on certain
machines.

.TP
\fB\-l\fR,\fB\-\-lang\fR=\fILANG\fR

Sets the LANG of the distribution.  RedHat has started to split their
distribution apart by locale.  For example \fBen\fR for English.  This
does not effect the locale that can be used once a system is running,
rather it sets the locale for the initial kickstart.  The default (and
only value supported) is \fBen\fR.

.TP
\fB\-h\fR,\fB\-\-help\fR

Print help text.

.TP
\fB\-\-mirror-dir\fR=\fIDIR\fR

Sets the DIR name of the NPACI Rocks or stock RedHat distribution.
The default is \fIpub/rocks/rocks-dist\fR which is where the
official NPACI Rocks distribution is found at ftp://@WEBSITE@.

.TP
\fB\-\-mirror-host\fR=\fIHOST\fR

Sets the HOST name for the NPACI Rocks or stock RedHat distribution to
be mirrored.  The mirror must be FTP accessible.  The default is the
official NPACI Rock home at \fI@WEBSITE@\fR.

.TP
\fB\-p\fR,\fB\-\-public\fR

Forces the removal of the local "Site.h" file and builds the kickstart
files with "Site.h.sample".  This is used to publish a Rocks
distribution without publishing sensitive information like the root
password and IP addresses.  The public flag also supresses inclusion
of RPMs (and SPRMs) in \fIroot\fR/contrib/private/[RPMS|SRPMS].

.TP
\fB-r\fR,\fB\-\-release\fR=\fIRELEASE\fR

Sets the RedHat Linux RELEASE number to base the distribution on.
Currently the following releases are known to work: \fI7.0\fR,
\fI7.1\fR.  The default value is \fI7.1\fR.

.TP
\fB\-\-root\fR=\fIDIR\fR

Sets the base DIR of the local mirror.  This must be an absolute
path name.  The default value is the current working directory.

.TP
\fB\-\-sdsc\fR

Used to internally by SDSC to create the official NPACI Rocks
distribution.  The flags allows SDSC to retrieve kickstart files from
CVS and do some other site specific things.

.SH EXAMPLES

\fI$ rocks-dist mirror dist\fR

Creates (or updates) the local NPACI Rocks mirror and then builds a
kickstart distribution called \fIrocks-dist\fR with symbolic links.

\fI$ rocks-dist -dist=$USER dist\fR

Created a private kickstart distribution so named after the user.
This is useful to test out a personal distribtuion on a couple
machines before kickstarting it on an entire cluster of machines.  The
new distribution can only be used for HTTP kickstarts.

\fI$ rocks-dist -dist=$USER genhdlist\fR

Updates the RPM database in the kickstart distribution \fI$USER\fR.
This is required every time a new RPM is added to the distribution's
RPM directory.

.SH FILES

When a new distribution is built RPMs are picked up from the following
directories, and the version numbers are resolved to insure only the
most recent of each package are included in the distribution.  You
never have to think about updates or patches, rocks-dist will take
care of you.

.TP
\fIroot\fR/\fImirror-host\fR/\fImirror-dir\fR/\fIrelease\fR/\fIlang\fR/os/\fIcpu\fR/RedHat/RPMS
.TP
\fIroot\fR/\fImirror-host\fR/\fImirror-dir\fR/\fIrelease\fR/\fIlang\fR/os/\fIcpu\fR/RPMS
.TP
/usr/src/redhat/RPMS/\fIcpu\fR
.TP
/usr/src/redhat/RPMS/noarch
.TP
\fIroot\fR/contrib/public/RPMS
.TP
\fIroot\fR/contrib/private/RPMS

To force a specific version of an RPM to be included in a distribution
run rock-dist, and then copy the RPM into the following directory, and
run rocks-dist again.

.TP
\fIdist-name\fR/\fIrelease\fR/\fIlang\fR/os/\fIcpu\fR/force/RPMS

.PP
Before processing command line options rocks-dist will attempt to
read flags from the following files.  The files may contain whitespace
and can use a '#' character to start a comment.  Sample files are
installed in /usr/lib/rocks-dist/.

.TP
/etc/rocks-distrc
.TP
\fI~\fR/.rocks-distrc
.TP
\fIcurrent-directory\fR/.rocks-distrc



.SH AUTHORS
Written by Mason Katz and Greg Bruno

.SH "REPORTING BUGS"
Report bugs to <@BUGREPORT@>.

.SH COPYRIGHT
Copyright \(co 2000 @COPYRIGHT@

.SH "SEE ALSO"
The NPACI Rocks web site and ftp site at http://@WEBSITE@ and
ftp://@WEBSITE@
