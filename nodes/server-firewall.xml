<?xml version="1.0" standalone="no"?>

<kickstart>


<description>
Server node firewall rules
</description>

<changelog>
$Log: server-firewall.xml,v $
Revision 1.4  2009/01/23 21:50:23  bruno
var tags converted to entities

Revision 1.3  2008/10/14 21:33:28  bruno
block mysql network requests

Revision 1.2  2008/07/29 17:13:41  bruno
open the web to the nodes on the public subnet

Revision 1.1  2007/12/10 21:28:33  bruno
the base roll now contains several elements from the HPC roll, thus
making the HPC roll optional.

this also includes changes to help build and configure VMs for V.

</changelog>


<post>
	
<file name="/etc/sysconfig/iptables">
*nat
-A POSTROUTING -o eth1 -j MASQUERADE
COMMIT

*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
# Preamble
-A FORWARD -i eth1 -o eth0 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i eth0 -j ACCEPT
-A INPUT -i eth0 -j ACCEPT
-A INPUT -i lo -j ACCEPT

# Allow these ports
-A INPUT -m state --state NEW -p tcp --dport ssh -j ACCEPT
# http and https is allowed for all nodes on the public subnet
-A INPUT -m state --state NEW -p tcp --dport https --source &Kickstart_PublicNetwork;/&Kickstart_PublicNetmask; -j ACCEPT
-A INPUT -m state --state NEW -p tcp --dport www --source &Kickstart_PublicNetwork;/&Kickstart_PublicNetmask; -j ACCEPT

# Standard rules
-A INPUT -p icmp --icmp-type any -j ACCEPT
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
# Uncomment the line below to log incoming packets.
#-A INPUT -j LOG --log-prefix "Unknown packet:"

# Deny section
-A INPUT -p udp --dport 0:1024 -j REJECT
-A INPUT -p tcp --dport 0:1024 -j REJECT
# Block incoming ganglia packets on public interface.
-A INPUT -p udp --dport 8649 -j REJECT
# Block mysql
-A INPUT -p udp --dport 3306 -j REJECT
-A INPUT -p tcp --dport 3306 -j REJECT

# For a draconian "drop-all" firewall, uncomment the line below.
#-A INPUT -j DROP
COMMIT
</file>

</post>

</kickstart> 
