<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
Configure a node's network
</description>


<copyright>
Copyright (c) 2000 - 2007 The Regents of the University of California.
All rights reserved. Rocks(tm) v4.3 www.rocksclusters.org
</copyright>


<changelog>
$Log: networking-server.xml,v $
Revision 1.1  2007/12/10 21:28:33  bruno
the base roll now contains several elements from the HPC roll, thus
making the HPC roll optional.

this also includes changes to help build and configure VMs for V.

</changelog>


<post>

MYHOST=<var name="Kickstart_PrivateHostname"/>

<file name="/etc/sysconfig/network"
	expr="/opt/rocks/bin/rocks config host network $MYHOST"/>

/opt/rocks/bin/rocks config host interface $MYHOST iface=eth0 > \
	/etc/sysconfig/network-scripts/ifcfg-eth0

/opt/rocks/bin/rocks config host interface $MYHOST iface=eth1 > \
	/etc/sysconfig/network-scripts/ifcfg-eth1

</post>


<post arg="--interpreter /usr/bin/python">
import string

file = open('/etc/modprobe.conf')
newfile = open('/tmp/modules.orig', 'w')

for line in file.readlines():
	tokens = string.split(line)
	if tokens[0] != 'alias' or tokens[1][0:3] != 'eth':
		newfile.write(line)

newfile.close()
file.close()
</post>

<post>
<file name="/etc/modprobe.conf" vars="expanded">
`cat /tmp/modprobe.conf.rocks`
</file>

<file name="/etc/modprobe.conf" mode="append" vars="expanded">
`cat /tmp/modules.orig`
</file>
</post>


</kickstart> 

