<?xml version="1.0" standalone="no"?>

<kickstart>

  <description>
  
  A server that has been kickstarted over the wide area network, from a
  central. 

  </description>

        <copyright>
        Copyright (c) 2000 - 2008 The Regents of the University of California.
        All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
        </copyright>

  <changelog>
  $Log: wan-install.xml,v $
  Revision 1.6  2008/10/18 00:55:46  mjk
  copyright 5.1

  Revision 1.5  2008/07/22 00:34:40  bruno
  first whack at vlan support

  Revision 1.4  2008/03/06 23:41:30  mjk
  copyright storm on

  Revision 1.3  2007/06/23 04:03:18  mjk
  mars hill copyright

  Revision 1.2  2005/09/12 21:13:21  mjk
  - Use the PublicAddress instead of PublicHostname for the wan url
  - This is needed for optiputer since the hostname is not the public one
  - The effect for everyone else is the /home/install/wan-dist-server directory
    will be named with an IP address rather than a hostname.

  Revision 1.1  2005/05/23 23:59:21  fds
  Frontend Restore

  </changelog>

<pre>

<eval shell="bash">

<!-- Make a new certificate for this frontend client. -->

echo "mkdir -p /tmp/security"
cert=`mktemp -dq /etc/security/ca/new-certs/cert.XXXXXX`

(
cd /etc/security/ca; \
/usr/bin/openssl req -new -nodes -config ca.cfg \
        -keyout $cert/key \
        -subj "\
/C=$Info_CertificateCountry/\
ST=$Info_CertificateState/\
L=$Info_CertificateLocality/\
O=$Info_CertificateOrganization/\
OU=$Info_ClusterName/\
CN=$Node_Hostname/\
CN=RocksMembership:External" \
        &gt; $cert/csr 2&gt;/dev/null 
)

echo "cat &gt; /tmp/security/cluster-cert.key &lt;&lt; 'EOF'"
cat $cert/key
echo "EOF"
echo 

# Sign the Cert with our CA.

(
cd /etc/security/ca; \
/usr/bin/openssl x509 -req -days 1000 \
        -CA ca.crt -CAkey ca.key -CAserial ca.serial \
        &lt; $cert/csr \
        &gt; $cert/crt 2&gt;/dev/null
)

echo "cat &gt; /tmp/security/cluster-cert.crt &lt;&lt; 'EOF'"
cat $cert/crt
echo "EOF"

rm -rf $cert

echo "chmod 0400 /tmp/security/cluster-cert.key"
echo "chmod 0444 /tmp/security/cluster-cert.crt"

</eval>

<eval>

<!-- Give a copy of our CA certificate -->

echo "cat &gt; /tmp/security/cluster-ca.crt &lt;&lt; 'EOF'"
cat /etc/security/ca/ca.crt
echo "EOF"

</eval>

</pre>


</kickstart> 

