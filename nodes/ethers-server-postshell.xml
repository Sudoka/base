<?xml version="1.0" standalone="no"?>
<kickstart>

<description>
	Intended to be run after postshell. Will re-source the probed-ethers.sh
	and then regenerate configs for the network interfaces, modprobe.conf.
	ethers-server.xml will have probed the interfaces to create 
	probed-ethers.sh. A user can put "postshell" on the command line and
	then edit probed-ethers.sh to arbitrarily re-assign mac:interface
	definitions.	
</description>

        <copyright>
        Copyright (c) 2000 - 2008 The Regents of the University of California.
        All rights reserved. Rocks(r) v5.0 www.rocksclusters.org
        </copyright>


<changelog>
$Log: ethers-server-postshell.xml,v $
Revision 1.6  2008/03/06 23:41:30  mjk
copyright storm on

Revision 1.5  2007/07/03 19:11:27  phil
update routes as apache -- should really be a rocks command.
Use rocks list host interface to get the set of network interfaces instead of
a direct mysql  call

Revision 1.4  2007/06/23 04:03:18  mjk
mars hill copyright

Revision 1.3  2006/06/21 03:09:53  bruno
updates to put the frontend networking info in the database just like
a compute node

Revision 1.2  2006/05/24 23:33:58  phil

Bruno sez: "Use file tags".
So it is written. So it shall be done.

Revision 1.1  2006/05/24 19:48:51  phil
Close the loop and have the network interface configuration be written
based on what is in the networks table.

</changelog>

<post>

<!-- Regenerate the ifcfg-device files -->
NETIFS=`/opt/rocks/bin/rocks list host interface jeebs  | /bin/sed -e '1d' | /bin/awk '{print $2}'`


for NETIF in $NETIFS; do 
	MYHOST=<var name="Kickstart_PrivateHostname"/>
	<file name="/etc/sysconfig/network-scripts/ifcfg-$NETIF"  
	expr="/opt/rocks/bin/dbreport ifcfg $NETIF $MYHOST"/>
done

<!-- Regenerate modprobe.conf -->
for NETIF in $NETIFS; do
	sed -i "/alias $NETIF/d" /etc/modprobe.conf
done

MYHOST=<var name="Kickstart_PrivateHostname"/>
<file name="/etc/modprobe.conf" mode="append" 
    expr="/opt/rocks/bin/dbreport ifcfg modules $MYHOST" />

</post>


</kickstart> 

