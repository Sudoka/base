<?xml version="1.0" standalone="no"?>

<kickstart interface="public">

	<description>
	The 'server node' in the graph.

	This file is used as a connection point for other XML
	configuration nodes.
	</description>

        <copyright>
        Copyright (c) 2000 - 2008 The Regents of the University of California.
        All rights reserved. Rocks(r) v5.0 www.rocksclusters.org
        </copyright>


<package>roll-base-usersguide</package>
<package>rocks-config-server</package>
<package>rocks-admin</package>


<post>

<file name="/etc/rc.d/rocksconfig.d/post-50-insert-pci" perms="555">
#!/bin/bash

/opt/rocks/sbin/insert-pcis &gt; /dev/null 2&gt;&amp;1 
</file>

<!-- On servers, turn off auto reinstall -->
/sbin/chkconfig rocks-grub off

</post>


<!--
	if this is a VM-based cluster, setup a variable that points back to
	server that is controlling this VM
-->

<pre>

VHA=<var name="VM_HostingAddress"/>

if [ ! -f /tmp/vm-hosting.sh ] &amp;&amp; [ "${VHA}" != "" ]
then
	echo '/opt/rocks/bin/rocks add var VM HostingAddress \
		<var name="VM_HostingAddress"/>' > /tmp/vm-hosting.sh 
fi

</pre>


<post arg="--nochroot">
cp /tmp/vm-hosting.sh /mnt/sysimage/tmp
</post>

<post>
sh /tmp/vm-hosting.sh
</post>

<post>
<!--
	send a message back to the hosting server to set the pxeboot action
	to boot off the local disk
-->
VHA=`/opt/rocks/bin/rocks list var VM HostingAddress output-col=value output-header=no`

if [ "${VHA}" != "" ]
then
	/usr/bin/wget --no-check-certificate -O /dev/null \
		https://${VHA}/install/sbin/setPxeboot.cgi?action="os"
fi
</post>


</kickstart> 

