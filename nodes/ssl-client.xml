<?xml version="1.0" standalone="no"?>

<kickstart>

  <description>

  Secure Sockets Layer for non-frontend nodes.

  </description>

        <copyright>
        Copyright (c) 2000 - 2008 The Regents of the University of California.
        All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
        </copyright>

  <changelog>
  $Log: ssl-client.xml,v $
  Revision 1.6  2009/01/23 23:19:31  mjk
  tweaks on the entities

  Revision 1.5  2008/10/18 00:55:46  mjk
  copyright 5.1

  Revision 1.4  2008/03/11 19:07:33  bruno
  ssl certificates moved in RHEL 5

  Revision 1.3  2008/03/06 23:41:30  mjk
  copyright storm on

  Revision 1.2  2007/06/23 04:03:18  mjk
  mars hill copyright

  Revision 1.1  2005/03/01 00:22:26  mjk
  moved to base roll

  Revision 1.3  2005/02/15 22:58:52  mjk
  dtd is gone

  Revision 1.2  2004/08/11 21:37:30  fds
  CN more correct.

  Revision 1.1  2004/08/10 19:05:42  fds
  Moved to new security graph hierarchy.

  </changelog>

<post>

<!-- Make a Certificate for Mod_SSL -->
<eval shell="bash" mode="xml">

cert=`mktemp -dq /etc/security/ca/new-certs/cert.XXXXXX`

(
cd /etc/security/ca; \
/usr/bin/openssl req -new -nodes -config ca.cfg \
	-keyout $cert/key \
	-subj "\
/C=$Info_CertificateCountry/\
ST=$Info_CertificateState/\
L=$Info_CertificateLocality/\
O=$Info_CertificateOrganization/\
OU=$Info_ClusterName/\
CN=&hostname;.$Kickstart_PrivateDNSDomain" \
	&gt; $cert/csr 2&gt;/dev/null
)

echo "&lt;file name='/etc/pki/tls/private/localhost.key' perms='0400'&gt;"
cat $cert/key
echo "&lt;/file&gt;"

<!-- Sign the Request with our CA-->
(
cd /etc/security/ca; \
/usr/bin/openssl x509 -req -days 1000 \
	-CA ca.crt -CAkey ca.key -CAserial ca.serial \
	&lt; $cert/csr \
	&gt; $cert/crt 2&gt;/dev/null
)

echo "&lt;file name='/etc/pki/tls/certs/localhost.crt' perms='0444'&gt;"
cat $cert/crt
echo "&lt;/file&gt;"

rm -rf $cert
</eval>

</post>

</kickstart> 

